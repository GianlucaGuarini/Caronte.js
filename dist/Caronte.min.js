!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Caronte=e()}(this,function(){"use strict";function t(t,r){var n=this;return this._init=function(){if(n.opts=r,n.el=n._getElement(t),!n.el)throw new Error('No form element found with the "'+t+'" selector');return e(n),n.input=n.el.querySelector("input[type=file]"),n._bind(),n},this._bind=function(){return n.el.addEventListener("submit",n._onSubmit,!1),n},this._onSubmit=function(t){t.preventDefault();var e=new FormData(t.target),r=new XMLHttpRequest;return n._total=0,Array.prototype.forEach.call(n.input.files,function(t){return n._total+=t.size}),r.open("post",n.el.getAttribute("action"),!0),r.onreadystatechange=n._onXhrLoaded,r.onerror=n._onXhrFailed,r.onabort=n._onXhrAborted,r.upload.addEventListener("progress",n._onXhrProgress),r.send(e),n},this._onXhrProgress=function(t){var e=100*(t.loaded/n._total).toFixed(2);return n.trigger("progress",~~e,t),n},this._onXhrLoaded=function(t){var e=t.target;return 4!==e.readyState?n:(e.status>=200&&e.status<400?n.trigger("success",JSON.parse(e.responseText)):n.trigger("error",e),n)},this._onXhrFailed=function(t){return n.trigger("error",t.target),n},this._onXhrAborted=function(t){return n.trigger("aborted",t.target),n},this._getElement=function(t){return"string"==typeof t?document.querySelector(t):t},this.destroy=function(){n.el.removeEventListener("submit",n._onSubmit),n.off("*")},this._init(),{destroy:this.destroy,on:this.on,off:this.off,one:this.one}}var e=function(t){t=t||{};var e={},r=0;return t.on=function(n,o){return"function"==typeof o&&(o._id="undefined"==typeof o._id?r++:o._id,n.replace(/\S+/g,function(t,r){(e[t]=e[t]||[]).push(o),o.typed=r>0})),t},t.off=function(r,n){return"*"===r?e={}:r.replace(/\S+/g,function(t){if(n)for(var r,o=e[t],i=0;r=o&&o[i];++i)r._id===n._id&&(o.splice(i,1),i--);else e[t]=[]}),t},t.one=function(e,r){function n(){t.off(e,n),r.apply(t,arguments)}return t.on(e,n)},t.trigger=function(r){for(var n,o=[].slice.call(arguments,1),i=e[r]||[],u=0;n=i[u];++u)n.busy||(n.busy=1,n.apply(t,n.typed?[r].concat(o):o),i[u]!==n&&u--,n.busy=0);return e.all&&"all"!==r&&t.trigger.apply(t,["all",r].concat(o)),t},t};return t});