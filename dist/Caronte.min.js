!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Caronte=e()}(this,function(){"use strict";function t(t,n){var r=this;if(this.opts=n,this.el=this._getElement(t),!this.el)throw new Error('No form element found with the "'+t+'" selector');return e(this),this.input=this.el.querySelector("input[type=file]"),this._bind(),{destroy:function(){return r.destroy},on:function(){return r.on},off:function(){return r.off},one:function(){return r.one}}}var e=function(t){t=t||{};var e={},n=0;return t.on=function(r,o){return"function"==typeof o&&(o._id="undefined"==typeof o._id?n++:o._id,r.replace(/\S+/g,function(t,n){(e[t]=e[t]||[]).push(o),o.typed=n>0})),t},t.off=function(n,r){return"*"===n?e={}:n.replace(/\S+/g,function(t){if(r)for(var n,o=e[t],i=0;n=o&&o[i];++i)n._id===r._id&&(o.splice(i,1),i--);else e[t]=[]}),t},t.one=function(e,n){function r(){t.off(e,r),n.apply(t,arguments)}return t.on(e,r)},t.trigger=function(n){for(var r,o=[].slice.call(arguments,1),i=e[n]||[],u=0;r=i[u];++u)r.busy||(r.busy=1,r.apply(t,r.typed?[n].concat(o):o),i[u]!==r&&u--,r.busy=0);return e.all&&"all"!==n&&t.trigger.apply(t,["all",n].concat(o)),t},t};return t.prototype={constructor:t,_bind:function(){var t=this;return this._onSubmitScoped=function(){return t._onSubmit},this.el.addEventListener("submit",this._onSubmitScoped,!1),this},_onSubmit:function(t){var e=this;t.preventDefault();var n=new FormData(t.target),r=new XMLHttpRequest;return this._total=0,Array.prototype.forEach.call(this.input.files,function(t){e._total+=t.size}),r.open("post",this.el.getAttribute("action"),!0),r.onreadystatechange=function(t){return e._onXhrLoaded(t)},r.onerror=function(t){return e._onXhrFailed(t)},r.onabort=function(t){return e._onXhrAborted(t)},r.upload.addEventListener("progress",function(t){return e._onXhrProgress(t)}),r.send(n),this},_onXhrProgress:function(t){var e=100*(t.loaded/this._total).toFixed(2);return this.trigger("progress",~~e,t),this},_onXhrLoaded:function(t){var e=t.target;return 4!==e.readyState?this:(e.status>=200&&e.status<400?this.trigger("success",JSON.parse(e.responseText)):this.trigger("error",e),this)},_onXhrFailed:function(t){return this.trigger("error",t.target),this},_onXhrAborted:function(t){return this.trigger("aborted",t.target),this},_getElement:function(t){return"string"==typeof t?document.querySelector(t):t},destroy:function(){this.el.removeEventListener("submit",this._onSubmitScoped),this.off("*")}},t});